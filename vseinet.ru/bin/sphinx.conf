source vseinet
{ 
    type                    = pgsql
    sql_host                = 192.168.122.195
    sql_port                = 5432
    sql_db                  = dev
    sql_user                = dev
    sql_pass                = SXmtU1JE1z
}

source base_product_index : vseinet
{
    sql_field_string        = name
    sql_attr_bool           = killbill
    sql_query_range         = SELECT MIN(bp.id), MAX(bp.id) FROM base_product AS bp
    sql_range_step          = 1000
    sql_ranged_throttle     = 10
    sql_query               = SELECT \
                                bp.id, \
                                bp.id::TEXT AS id_str, \
                                bp.name, \
                                bp.category_id, \
                                bp.category_section_id, \
                                bp.brand_id, \
                                bpd.details, \
                                i.availability, \
                                i.price, \
                                i.price_order, \
                                i.profit, \
                                i.rating, \
                                i.nofilled, \
                                bp.created_at, \
                                0 AS killbill \
                            FROM base_product AS bp \ 
                            INNER JOIN base_product_data AS bpd ON bpd.base_product_id = bp.id \
                            INNER JOIN base_product_index as i ON i.base_product_id = bp.id \
                            WHERE bp.id BETWEEN $start AND $end
}

index base_product_index
{
    source                  = base_product_index
    path                    = /var/lib/sphinx/data/base_product_index
    docinfo                 = extern
    morphology              = stem_en, lemmatize_ru
    min_infix_len           = 1
    min_word_len            = 1
    expand_keywords         = 1
    index_exact_words       = 1
    charset_table           = 0..9, A..Z->a..z, _, a..z, \
                            U+410..U+42F->U+430..U+44F, U+430..U+44F, U+401->U+0435, U+451->U+0435
    #wordforms               = /var/lib/sphinx/wordforms.txt
}

index base_product_index_rt
{
    type                    = rt 
    rt_field                = name 
    rt_attr_string          = name
    rt_attr_bool            = killbill
    path                    = /var/lib/sphinx/data/base_product_index_rt 
    docinfo                 = extern
    morphology              = stem_en, lemmatize_ru
    min_infix_len           = 1
    min_word_len            = 1
    expand_keywords         = 1
    index_exact_words       = 1
    charset_table           = 0..9, A..Z->a..z, _, a..z, \
                            U+410..U+42F->U+430..U+44F, U+430..U+44F, U+401->U+0435, U+451->U+0435
    #wordforms               = /var/lib/sphinx/wordforms.txt
    rt_mem_limit            = 1024M
}

index base_product
{
    type                    = distributed
    local                   = base_product_index
    local                   = base_product_index_rt
}

source supplier_product_index : vseinet 
{
    sql_field_string        = code
    sql_attr_bool           = killbill
    sql_query_range         = SELECT MIN(sp.id), MAX(sp.id) FROM supplier_product sp INNER JOIN base_product bp ON bp.id = sp.base_product_id
    sql_range_step          = 1000
    sql_ranged_throttle     = 10
    sql_query               = SELECT sp.id, LOWER(COALESCE(sp.code, sp.article)) AS code, 0 AS killbill FROM supplier_product sp WHERE sp.id BETWEEN $start AND $end  
}

index supplier_product_index
{
    source                  = supplier_product_index
    path                    = /var/lib/sphinx/data/supplier_product_index
    docinfo                 = extern
    morphology              = stem_en, lemmatize_ru
    min_infix_len           = 1
    min_word_len            = 1
    expand_keywords         = 1
    index_exact_words       = 1
    charset_table           = 0..9, A..Z->a..z, _, a..z, \
                            U+410..U+42F->U+430..U+44F, U+430..U+44F, U+401->U+0435, U+451->U+0435
    #wordforms               = /var/lib/sphinx/wordforms.txt
}

index supplier_product_index_rt
{
    type                    = rt 
    rt_field                = code 
    rt_attr_string          = code
    rt_attr_bool            = killbill
    path                    = /var/lib/sphinx/data/supplier_product_index_rt 
    docinfo                 = extern
    morphology              = stem_en, lemmatize_ru
    min_infix_len           = 1
    min_word_len            = 1
    expand_keywords         = 1
    index_exact_words       = 1
    charset_table           = 0..9, A..Z->a..z, _, a..z, \
                            U+410..U+42F->U+430..U+44F, U+430..U+44F, U+401->U+0435, U+451->U+0435
    #wordforms               = /var/lib/sphinx/wordforms.txt
    rt_mem_limit            = 1024M
}

index supplier_product
{
    type                    = distributed
    local                   = supplier_product_index
    local                   = supplier_product_index_rt
}

common 
{
    lemmatizer_base         = /var/lib/sphinx/dict
}

indexer
{
    mem_limit               = 512M
}

searchd
{
    listen                  = 9306:mysql41
    log                     = /var/log/sphinx/searchd.log
    query_log               = /var/log/sphinx/query.log
    read_timeout            = 5
    max_children            = 300
    pid_file                = /var/run/sphinx/searchd.pid
    seamless_rotate         = 1
    preopen_indexes         = 0
    max_filters             = 256
    max_filter_values       = 4096
    unlink_old              = 1
    workers                 = threads
    binlog_path             = /var/lib/sphinx/binlog
}